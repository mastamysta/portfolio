<!doctype html>
<html>

  <head>
    <meta charset="utf-8" name="viewport" content="width=viewport-width, initial-scale=1.0">
    <title>Snake</title>
  </head>
  <link type="text/css" rel="Stylesheet" href="Stylesheets/snake.css">
  <link type="text/css" rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <script src="Scripts/jquery-3.5.1.min.js"></script>
  <body>

    <div class="container">
      <table style="width:100%" id="container-table">
        <tr>
          <td>
            <div class="page-header" style="padding:20px">
              <h1>Snake.js</h1>
            </div>
            <div class="container-md">
              <canvas id="snakeCanvas" width="400px" height="400px">
            </div>
            <br>
            <button class="btn btn-primary" id="back-button">Back</button>
          </td>
          <td>
            <div class="jumbotron" id="controls-jumbo">
              <h1>Controls</h1>
              <hr style="top-border:grey">
              <p>
                Controls:
                <ul>
                  <li>Up</li>
                  <li>Down</li>
                  <li>Left</li>
                  <li>Right</li>
                  <li>Pause - Esc</li>
                  <li>Resume - 1</li>
                </ul>
              </p>
            </div>
          </td>
        </tr>
      </table>
    </div>

  </body>

  <script>
  var intervalID = null;
  window.onload = function(){
    canv = document.getElementById('snakeCanvas');
    ctx = canv.getContext("2d");
    document.addEventListener("keydown", keyPush);
    intervalID = setInterval(game, 1000/10);
    console.log("Here");
  }

  var xVelocity = 0, yVelocity = 0;
  const cellSize = 400 / 10;
  const SPEED = cellSize;
  var trail = new Array({
    xPos: Math.floor(Math.random() * 400 / cellSize) * cellSize,
     yPos: Math.floor(Math.random() * 400 / cellSize) * cellSize
   });
  var aPosX = Math.floor(Math.random() * 400 / cellSize) * cellSize;
  var aPosY = Math.floor(Math.random() * 400 / cellSize) * cellSize;

//handle keypress event
  function keyPush(e){
    keyCode = e.keyCode
    switch (keyCode) {
      case 37:
        if (xVelocity == SPEED){

        }
        else{
          xVelocity = -SPEED;
          yVelocity = 0;
        }
        break;
      case 38:
        if (yVelocity == SPEED){

        }
        else{
          xVelocity = 0;
          yVelocity = -SPEED;
        }
        break;
      case 39:
        if (xVelocity == -SPEED){

        }
        else{
          xVelocity = SPEED;
          yVelocity = 0;
        }
        break;
      case 40:
        if (yVelocity == -SPEED){

        }
        else{
          xVelocity = 0;
          yVelocity = SPEED;
        }
        break;
      case 27:
          clearInterval(intervalID);
        break;
      case 49:
          intervalID = setInterval(game, 1000/10);
        break;
      default:
        break;

    }
    console.log(xVelocity + " " +  yVelocity);
  }

  function game(){


//move tail peices
    for(i = trail.length - 1; i > 0; i --){
      console.log(i);
      trail[i].xPos = trail[i - 1].xPos;
      trail[i].yPos = trail[i - 1].yPos;
    }

//move head
    trail[0].xPos += xVelocity;
    trail[0].yPos += yVelocity;

//teleport head if its off the edge
    if(trail[0].xPos < 0){
      trail[0].xPos = 400 - cellSize;
    }
    else if(trail[0].xPos > 400 - cellSize){
      trail[0].xPos = 0;
    }
    else if(trail[0].yPos < 0){
      trail[0].yPos = 400 - cellSize;
    }
    else if(trail[0].yPos > 400 - cellSize){
      trail[0].yPos = 0;
    }


//draw background
    ctx.fillStyle="black";
    ctx.fillRect(0, 0, document.getElementById("snakeCanvas").width,  document.getElementById("snakeCanvas").height);
    ctx.fillStyle="lime";
//draw each snake segment and check for collision with head
    for(let elem of trail){
      ctx.fillRect(elem.xPos, elem.yPos, cellSize, cellSize);
      if(trail[0].xPos == elem.xPos && trail[0].yPos == elem.yPos && elem !== trail[0]){
        location.reload();
        console.log("reloaded");
      }
    }


//check for collision with apple
    if(trail[0].xPos == aPosX && trail[0].yPos == aPosY){
      trail[trail.length] = {xPos: aPosX, yPos: aPosY};
      aPosX = Math.floor(Math.random() * 400 / cellSize) * cellSize;
      aPosY = Math.floor(Math.random() * 400 / cellSize) * cellSize;
     }

     //draw apple
    ctx.fillStyle="red";
    ctx.fillRect(aPosX, aPosY, cellSize, cellSize);
  }


//function to navigate to index again
  function goTo(location){
    window.location.href=location;
  }

  $("#back-button").on("click", function(){
    goTo("index.html");
  });
  </script>

</html>
